<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pesquisa da B√≠blia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .search-container {
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .book-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .book-select, .chapter-select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .book-select:focus, .chapter-select:focus {
            border-color: #3498db;
        }

        .content {
            padding: 30px;
            min-height: 400px;
        }

        .chapter-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            padding: 15px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid #3498db;
        }

        .verse {
            margin-bottom: 15px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .verse:hover {
            transform: translateX(5px);
            border-left-color: #3498db;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .verse-number {
            font-weight: bold;
            color: #3498db;
            margin-right: 10px;
            font-size: 0.9rem;
        }

        .verse-text {
            color: #2c3e50;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .search-results {
            margin-top: 20px;
        }

        .search-result-item {
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
            border-left: 4px solid #3498db;
        }

        .result-reference {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 8px;
        }

        .result-text {
            color: #2c3e50;
            line-height: 1.6;
        }

        .highlight {
            background: linear-gradient(45deg, #f39c12, #f1c40f);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .search-box {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .book-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ Sistema de Pesquisa da B√≠blia</h1>
            <p>Explore as Escrituras Sagradas</p>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="Digite sua pesquisa aqui..." />
                <button id="searchBtn" class="search-btn">üîç Pesquisar</button>
            </div>

            <div class="book-selector">
                <select id="bookSelect" class="book-select">
                    <option value="">Selecione um livro...</option>
                </select>
                <select id="chapterSelect" class="chapter-select">
                    <option value="">Selecione um cap√≠tulo...</option>
                </select>
                <button id="loadChapterBtn" class="search-btn">Carregar Cap√≠tulo</button>
            </div>
        </div>

        <div class="content">
            <div id="chapterTitle" class="chapter-title"></div>
            <div id="contentArea"></div>
        </div>
    </div>

    <script>
        let bibleData = [];
        let currentSearchResults = [];
        let loadedBooks = new Set(); // Para rastrear quais livros j√° foram carregados

        // Carrega a B√≠blia da API espec√≠fica com carregamento otimizado
        async function loadBible() {
            try {
                showLoading();
                
                // Usando CORS proxy apenas se necess√°rio
                const apiUrl = 'https://ivaldofs.com.br/api/acf.json';
                let response;
                
                try {
                    // Tentativa direta primeiro
                    response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Resposta n√£o OK');
                } catch (error) {
                    // Se falhar, tenta com proxy CORS
                    console.log('Tentando com proxy CORS...');
                    const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(apiUrl);
                    response = await fetch(proxyUrl);
                }
                
                const data = await response.json();
                
                if (data && Array.isArray(data)) {
                    bibleData = data;
                    populateBookSelector();
                    
                    // Carrega apenas G√™nesis inicialmente
                    await loadInitialContent();
                }
            } catch (error) {
                console.error('Erro ao carregar a B√≠blia:', error);
                showError();
            }
        }

        // Carrega o conte√∫do inicial (G√™nesis 1)
        async function loadInitialContent() {
            const genesisIndex = bibleData.findIndex(book => book.abbrev === 'Gn');
            if (genesisIndex !== -1) {
                loadedBooks.add(genesisIndex); // Marca como carregado
                const genesisBook = bibleData[genesisIndex];
                displayChapter(genesisBook, 0, 'G√™nesis');
            }
        }

        // Popula o seletor de livros
        function populateBookSelector() {
            const bookSelect = document.getElementById('bookSelect');
            bookSelect.innerHTML = '<option value="">Selecione um livro...</option>';
            
            bibleData.forEach((book, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = getFullBookName(book.abbrev);
                bookSelect.appendChild(option);
            });
        }

        // Retorna o nome completo do livro
        function getFullBookName(abbrev) {
            const bookNames = {
                'Gn': 'G√™nesis', 'Ex': '√äxodo', 'Lv': 'Lev√≠tico', 'Nm': 'N√∫meros', 'Dt': 'Deuteron√¥mio',
                'Js': 'Josu√©', 'Jz': 'Ju√≠zes', 'Rt': 'Rute', '1Sm': '1 Samuel', '2Sm': '2 Samuel',
                '1Rs': '1 Reis', '2Rs': '2 Reis', '1Cr': '1 Cr√¥nicas', '2Cr': '2 Cr√¥nicas', 'Ed': 'Esdras',
                'Ne': 'Neemias', 'Et': 'Ester', 'J√≥': 'J√≥', 'Sl': 'Salmos', 'Pv': 'Prov√©rbios',
                'Ec': 'Eclesiastes', 'Ct': 'Cantares', 'Is': 'Isa√≠as', 'Jr': 'Jeremias', 'Lm': 'Lamenta√ß√µes',
                'Ez': 'Ezequiel', 'Dn': 'Daniel', 'Os': 'Os√©ias', 'Jl': 'Joel', 'Am': 'Am√≥s',
                'Ob': 'Obadias', 'Jn': 'Jonas', 'Mq': 'Miqu√©ias', 'Na': 'Naum', 'Hc': 'Habacuque',
                'Sf': 'Sofonias', 'Ag': 'Ageu', 'Zc': 'Zacarias', 'Ml': 'Malaquias', 'Mt': 'Mateus',
                'Mc': 'Marcos', 'Lc': 'Lucas', 'Jo': 'Jo√£o', 'At': 'Atos', 'Rm': 'Romanos',
                '1Co': '1 Cor√≠ntios', '2Co': '2 Cor√≠ntios', 'Gl': 'G√°latas', 'Ef': 'Ef√©sios', 'Fp': 'Filipenses',
                'Cl': 'Colossenses', '1Ts': '1 Tessalonicenses', '2Ts': '2 Tessalonicenses', '1Tm': '1 Tim√≥teo',
                '2Tm': '2 Tim√≥teo', 'Tt': 'Tito', 'Fm': 'Filemom', 'Hb': 'Hebreus', 'Tg': 'Tiago',
                '1Pe': '1 Pedro', '2Pe': '2 Pedro', '1Jo': '1 Jo√£o', '2Jo': '2 Jo√£o', '3Jo': '3 Jo√£o',
                'Jd': 'Judas', 'Ap': 'Apocalipse'
            };
            return bookNames[abbrev] || abbrev;
        }

        // Popula o seletor de cap√≠tulos
        function populateChapterSelector(bookIndex) {
            const chapterSelect = document.getElementById('chapterSelect');
            chapterSelect.innerHTML = '<option value="">Selecione um cap√≠tulo...</option>';
            
            if (bookIndex !== '' && bibleData[bookIndex]) {
                const chapters = bibleData[bookIndex].chapters;
                for (let i = 0; i < chapters.length; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Cap√≠tulo ${i + 1}`;
                    chapterSelect.appendChild(option);
                }
            }
        }

        // Exibe um cap√≠tulo
        function displayChapter(book, chapterIndex, bookName) {
            const chapter = book.chapters[chapterIndex];
            const chapterTitle = document.getElementById('chapterTitle');
            const contentArea = document.getElementById('contentArea');
            
            chapterTitle.textContent = `${bookName} - Cap√≠tulo ${chapterIndex + 1}`;
            
            let html = '';
            chapter.forEach((verse, index) => {
                html += `
                    <div class="verse">
                        <span class="verse-number">${index + 1}</span>
                        <span class="verse-text">${verse}</span>
                    </div>
                `;
            });
            
            contentArea.innerHTML = html;
        }

        // Realiza pesquisa
        function performSearch(searchTerm) {
            if (!searchTerm.trim()) {
                alert('Digite um termo para pesquisar');
                return;
            }

            showLoading('Pesquisando...');
            currentSearchResults = [];
            
            const searchTermLower = searchTerm.toLowerCase();
            
            // Como todos os dados j√° est√£o carregados, pesquisamos diretamente
            bibleData.forEach((book) => {
                const bookName = getFullBookName(book.abbrev);
                
                book.chapters.forEach((chapter, chapterIndex) => {
                    chapter.forEach((verse, verseIndex) => {
                        if (verse.toLowerCase().includes(searchTermLower)) {
                            currentSearchResults.push({
                                book: bookName,
                                chapter: chapterIndex + 1,
                                verse: verseIndex + 1,
                                text: verse,
                                searchTerm: searchTerm
                            });
                        }
                    });
                });
            });
            
            displaySearchResults();
        }

        // Exibe resultados da pesquisa
        function displaySearchResults() {
            const chapterTitle = document.getElementById('chapterTitle');
            const contentArea = document.getElementById('contentArea');
            
            if (currentSearchResults.length === 0) {
                chapterTitle.textContent = 'Nenhum resultado encontrado';
                contentArea.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Tente outros termos de pesquisa.</p>';
                return;
            }
            
            chapterTitle.textContent = `Resultados da Pesquisa (${currentSearchResults.length} encontrados)`;
            
            let html = '';
            currentSearchResults.forEach((result) => {
                const highlightedText = highlightSearchTerm(result.text, result.searchTerm);
                html += `
                    <div class="search-result-item">
                        <div class="result-reference">${result.book} ${result.chapter}:${result.verse}</div>
                        <div class="result-text">${highlightedText}</div>
                    </div>
                `;
            });
            
            contentArea.innerHTML = html;
        }

        // Destaca o termo pesquisado
        function highlightSearchTerm(text, searchTerm) {
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Mostra indicador de carregamento
        function showLoading(message = 'Carregando...') {
            document.getElementById('contentArea').innerHTML = 
                `<div class="loading">‚è≥ ${message}</div>`;
        }

        // Mostra mensagem de erro
        function showError() {
            document.getElementById('contentArea').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h2 style="color: #e74c3c;">Erro ao carregar a B√≠blia</h2>
                    <p style="color: #7f8c8d;">N√£o foi poss√≠vel carregar os dados da API.</p>
                    <button onclick="location.reload()" class="search-btn" style="margin-top: 15px;">Tentar Novamente</button>
                </div>
            `;
        }

        // Event Listeners
        document.getElementById('searchBtn').addEventListener('click', () => {
            const searchTerm = document.getElementById('searchInput').value;
            performSearch(searchTerm);
        });

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const searchTerm = document.getElementById('searchInput').value;
                performSearch(searchTerm);
            }
        });

        document.getElementById('bookSelect').addEventListener('change', (e) => {
            const bookIndex = e.target.value;
            if (bookIndex !== '') {
                loadedBooks.add(parseInt(bookIndex)); // Marca como carregado
                populateChapterSelector(bookIndex);
            }
        });

        document.getElementById('loadChapterBtn').addEventListener('click', () => {
            const bookIndex = document.getElementById('bookSelect').value;
            const chapterIndex = document.getElementById('chapterSelect').value;
            
            if (bookIndex !== '' && chapterIndex !== '') {
                const book = bibleData[bookIndex];
                const bookName = getFullBookName(book.abbrev);
                displayChapter(book, parseInt(chapterIndex), bookName);
            } else {
                alert('Selecione um livro e um cap√≠tulo');
            }
        });

        // Carrega a B√≠blia ao iniciar a p√°gina
        window.addEventListener('load', loadBible);
    </script>

<footer style="background: linear-gradient(45deg, #2c3e50, #3498db); color: white; text-align: center; padding: 20px; border-top-left-radius: 20px; border-top-right-radius: 20px; margin-top: 40px;">
    <p>&copy; Sistema de Pesquisa da B√≠blia | Desenvolvido por <a href="https://septuaginta.com.br/" target="_blank" style="color: #f1c40f; text-decoration: none;">Septuaginta.com.br</a></p>
    <p>Todos os direitos reservados.</p>
</footer>
</body>
</html>